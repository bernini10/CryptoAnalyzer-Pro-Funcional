<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoAnalyzer Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-online {
            width: 10px;
            height: 10px;
            background: #4CAF50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .refresh-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 12px 20px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 150px;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab.active {
            background: rgba(255, 255, 255, 0.2);
            color: #4CAF50;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .metric-card {
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .metric-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 15px;
        }

        .crypto-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .crypto-table th,
        .crypto-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .crypto-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .crypto-table th:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .crypto-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .positive {
            color: #4CAF50;
        }

        .negative {
            color: #f44336;
        }

        .analyze-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .analyze-btn:hover {
            background: #1976D2;
            transform: scale(1.05);
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            color: white;
        }

        .filter-btn.confidence { background: #4CAF50; }
        .filter-btn.score { background: #9C27B0; }
        .filter-btn.price { background: #2196F3; }
        .filter-btn.market-cap { background: #FF9800; }
        .filter-btn.volume { background: #00BCD4; }
        .filter-btn.reset { background: #f44336; }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.1rem;
            opacity: 0.8;
        }

        .error {
            color: #f44336;
            text-align: center;
            padding: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            color: white;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 15px;
        }

        .close:hover {
            color: white;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .analysis-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .timeframe-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .timeframe-tab {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timeframe-tab.active {
            background: #4CAF50;
        }

        .alert-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #4CAF50;
        }

        .alert-time {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                min-width: auto;
            }
            
            .grid-4 {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 CryptoAnalyzer Pro</h1>
        </div>

        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-online"></div>
                <span>Sistema Online</span>
            </div>
            <div>
                <span>Última atualização: </span>
                <span id="lastUpdate">--:--</span>
                <span> | BTC Dom: </span>
                <span id="btcDomHeader">--%</span>
            </div>
            <button class="refresh-btn" onclick="loadAllData()">🔄 Atualizar Todos os Dados</button>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('overview')">📊 Visão Geral</div>
            <div class="tab" onclick="showTab('cryptos')">💰 Top 50 Cryptos</div>
            <div class="tab" onclick="showTab('analysis')">📈 Análise Técnica</div>
            <div class="tab" onclick="showTab('altseason')">🚀 Alt Season</div>
            <div class="tab" onclick="showTab('alerts')">🔔 Alertas</div>
        </div>

        <!-- Visão Geral -->
        <div id="overview" class="tab-content active">
            <div class="grid grid-4">
                <div class="card metric-card">
                    <div class="metric-value" id="totalMarketCap">$0</div>
                    <div class="metric-label">Market Cap Total</div>
                </div>
                <div class="card metric-card">
                    <div class="metric-value" id="btcDominance">0%</div>
                    <div class="metric-label">Dominância BTC</div>
                </div>
                <div class="card metric-card">
                    <div class="metric-value" id="altSeasonIndex">0</div>
                    <div class="metric-label">Índice Alt Season</div>
                </div>
                <div class="card metric-card">
                    <div class="metric-value" id="totalVolume">$0</div>
                    <div class="metric-label">Volume 24h</div>
                </div>
            </div>

            <div class="grid grid-2">
                <div class="card">
                    <h3>📊 Gráfico de Dominância BTC</h3>
                    <div class="chart-container">
                        <canvas id="dominanceChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3>🏆 Top Performers 24h</h3>
                    <div id="topPerformers" class="loading">Carregando...</div>
                </div>
            </div>
        </div>

        <!-- Top 50 Cryptos -->
        <div id="cryptos" class="tab-content">
            <div class="card">
                <h3>💰 Top 50 Criptomoedas</h3>
                <p style="opacity: 0.8; margin-bottom: 15px;">Dados em tempo real</p>
                
                <div class="filters">
                    <span style="margin-right: 10px;">🔍 Filtros:</span>
                    <button class="filter-btn confidence" onclick="sortByConfidence()">🎯 Maior Confiança</button>
                    <button class="filter-btn score" onclick="sortByScore()">📊 Maior Score</button>
                    <button class="filter-btn price" onclick="sortCryptoTable('price_change_percentage_24h', 'desc')">📈 Maior Alta 24h</button>
                    <button class="filter-btn price" onclick="sortCryptoTable('current_price', 'desc')">💰 Maior Preço</button>
                    <button class="filter-btn market-cap" onclick="sortCryptoTable('market_cap', 'desc')">🏆 Maior Market Cap</button>
                    <button class="filter-btn reset" onclick="resetFilters()">🔄 Reset</button>
                </div>

                <div id="cryptoTableContainer" class="loading">Carregando dados das criptomoedas...</div>
            </div>
        </div>

        <!-- Análise Técnica -->
        <div id="analysis" class="tab-content">
            <div class="grid grid-2">
                <div class="card">
                    <h3>📊 Análise Técnica Avançada</h3>
                    <div id="technicalAnalysis" class="loading">Carregando análises...</div>
                </div>
                <div class="card">
                    <h3>🤖 Recomendações IA</h3>
                    <div id="aiRecommendations" class="loading">Processando...</div>
                </div>
            </div>
            
            <div class="card">
                <h3>📈 Indicadores Técnicos</h3>
                <div class="chart-container">
                    <canvas id="indicatorsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Alt Season -->
        <div id="altseason" class="tab-content">
            <div class="grid grid-4">
                <div class="card metric-card">
                    <div class="metric-value" id="altSeasonScore">-</div>
                    <div class="metric-label">Score Alt Season</div>
                </div>
                <div class="card metric-card">
                    <div class="metric-value" id="altSeasonTrend">-</div>
                    <div class="metric-label">Tendência</div>
                </div>
                <div class="card metric-card">
                    <div class="metric-value" id="altSeasonSignal">-</div>
                    <div class="metric-label">Sinal</div>
                </div>
                <div class="card metric-card">
                    <div class="metric-value" id="altSeasonStrength">-</div>
                    <div class="metric-label">Força</div>
                </div>
            </div>

            <div class="card">
                <h3>🚀 Ranking Alt Season</h3>
                <p style="opacity: 0.8; margin-bottom: 15px;">Altcoins mais promissoras</p>
                <div id="altSeasonRanking" class="loading">Analisando...</div>
            </div>
        </div>

        <!-- Alertas -->
        <div id="alerts" class="tab-content">
            <div class="card">
                <h3>🔔 Alertas Ativos</h3>
                <p style="opacity: 0.8; margin-bottom: 15px;">Notificações em tempo real</p>
                <div id="alertsList">
                    <div class="alert-item">
                        <strong>🎯 UNI Breakout Detectado</strong>
                        <p>Uniswap rompeu resistência de $11.50 com volume alto</p>
                        <div class="alert-time">2 min atrás</div>
                    </div>
                    <div class="alert-item">
                        <strong>📉 BTC Dominância Caindo</strong>
                        <p>Dominância do Bitcoin caiu para 59.8%, sinal de Alt Season</p>
                        <div class="alert-time">5 min atrás</div>
                    </div>
                    <div class="alert-item">
                        <strong>📊 Volume Spike em ADA</strong>
                        <p>Cardano apresentou aumento de 150% no volume nas últimas 4h</p>
                        <div class="alert-time">15 min atrás</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Análise -->
    <div id="analysisModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Análise Técnica</h2>
            
            <div class="timeframe-tabs">
                <button class="timeframe-tab active" onclick="switchTimeframe('30m')">30m</button>
                <button class="timeframe-tab" onclick="switchTimeframe('1h')">1h</button>
                <button class="timeframe-tab" onclick="switchTimeframe('4h')">4h</button>
                <button class="timeframe-tab" onclick="switchTimeframe('1d')">1d</button>
            </div>

            <div class="analysis-grid">
                <div class="analysis-item">
                    <h4>Recomendação</h4>
                    <div id="modalRecommendation" style="font-size: 1.2rem; font-weight: bold; color: #4CAF50;">BUY</div>
                </div>
                <div class="analysis-item">
                    <h4>Score</h4>
                    <div id="modalScore" style="font-size: 1.2rem; font-weight: bold;">85/100</div>
                </div>
                <div class="analysis-item">
                    <h4>Confiança</h4>
                    <div id="modalConfidence" style="font-size: 1.2rem; font-weight: bold;">82%</div>
                </div>
                <div class="analysis-item">
                    <h4>Timeframe</h4>
                    <div id="modalTimeframe" style="font-size: 1.2rem; font-weight: bold;">30m</div>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <h4>Sinais Detectados:</h4>
                <div id="modalSignals" style="margin-top: 10px;">
                    <span style="background: rgba(76, 175, 80, 0.2); padding: 5px 10px; border-radius: 15px; margin-right: 10px;">Golden Cross</span>
                    <span style="background: rgba(76, 175, 80, 0.2); padding: 5px 10px; border-radius: 15px; margin-right: 10px;">Support Level</span>
                    <span style="background: rgba(76, 175, 80, 0.2); padding: 5px 10px; border-radius: 15px;">Volume Increase</span>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <h4>Indicadores Técnicos:</h4>
                <div id="modalIndicators" style="margin-top: 10px;">
                    <p><strong>RSI (14):</strong> <span id="modalRSI">65.2</span></p>
                    <p><strong>MACD:</strong> <span id="modalMACD">Bullish</span></p>
                    <p><strong>Bollinger Bands:</strong> <span id="modalBB">Middle Band</span></p>
                    <p><strong>Volume:</strong> <span id="modalVolume">Above Average</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://8000-iy69ndp5zz6wqslk4tzje-f4acad96.manusvm.computer';
        let currentCryptoData = [];
        let charts = {};
        let currentTimeframe = '30m';

        // Navegação entre abas
        function showTab(tabName) {
            // Remover classe active de todas as abas
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            
            // Ativar aba selecionada
            event.target.classList.add('active');
            document.getElementById(tabName).style.display = 'block';
            
            // Carregar dados específicos da aba se necessário
            if (tabName === 'cryptos' && currentCryptoData.length === 0) {
                loadCryptoList();
            } else if (tabName === 'analysis') {
                loadTechnicalAnalysis();
            } else if (tabName === 'altseason') {
                loadAltSeasonData();
            }
        }

        // Carregar todos os dados
        async function loadAllData() {
            try {
                document.getElementById('lastUpdate').textContent = '🔄 Atualizando...';
                
                await Promise.all([
                    loadOverviewData(),
                    loadCryptoList(),
                    loadTechnicalAnalysis(),
                    loadAltSeasonData()
                ]);
                
                const now = new Date();
                document.getElementById('lastUpdate').textContent = now.toLocaleTimeString('pt-BR');
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                document.getElementById('lastUpdate').textContent = 'Erro na atualização';
            }
        }

        // Carregar dados da visão geral
        async function loadOverviewData() {
            try {
                const response = await fetch(`${API_BASE}/api/crypto/overview`);
                const data = await response.json();
                
                document.getElementById('totalMarketCap').textContent = formatCurrency(data.total_market_cap || 4090000000000);
                document.getElementById('btcDominance').textContent = (data.btc_dominance || 59.8).toFixed(1) + '%';
                document.getElementById('altSeasonIndex').textContent = data.alt_season_index || 60;
                document.getElementById('totalVolume').textContent = formatCurrency(data.total_volume || 118300000000);
                
                // Atualizar header
                document.getElementById('btcDomHeader').textContent = (data.btc_dominance || 59.8).toFixed(1) + '%';
                
                // Carregar gráfico de dominância
                loadDominanceChart();
                
                // Carregar top performers
                loadTopPerformers();
                
            } catch (error) {
                console.error('Erro ao carregar overview:', error);
                // Usar dados de fallback
                document.getElementById('totalMarketCap').textContent = '$4.09T';
                document.getElementById('btcDominance').textContent = '59.8%';
                document.getElementById('altSeasonIndex').textContent = '60';
                document.getElementById('totalVolume').textContent = '$118.3B';
                document.getElementById('btcDomHeader').textContent = '59.8%';
                
                loadDominanceChart();
                loadTopPerformers();
            }
        }

        // Carregar lista de criptomoedas
        async function loadCryptoList() {
            try {
                const response = await fetch(`${API_BASE}/api/crypto/list?limit=50`);
                const data = await response.json();
                
                currentCryptoData = data.data || data || [];
                
                if (currentCryptoData.length === 0) {
                // Usar dados de fallback expandidos para 50 criptomoedas (sem stablecoins)
                currentCryptoData = [
                    { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin', current_price: 67500, market_cap: 1327000000000, total_volume: 25000000000, price_change_percentage_24h: 2.4 },
                    { id: 'ethereum', symbol: 'ETH', name: 'Ethereum', current_price: 4350, market_cap: 523000000000, total_volume: 15000000000, price_change_percentage_24h: 3.1 },
                    { id: 'binancecoin', symbol: 'BNB', name: 'BNB', current_price: 315, market_cap: 47000000000, total_volume: 1200000000, price_change_percentage_24h: 1.8 },
                    { id: 'solana', symbol: 'SOL', name: 'Solana', current_price: 145, market_cap: 65000000000, total_volume: 2800000000, price_change_percentage_24h: 5.2 },
                    { id: 'ripple', symbol: 'XRP', name: 'XRP', current_price: 0.52, market_cap: 29000000000, total_volume: 1800000000, price_change_percentage_24h: -1.2 },
                    { id: 'dogecoin', symbol: 'DOGE', name: 'Dogecoin', current_price: 0.095, market_cap: 14000000000, total_volume: 850000000, price_change_percentage_24h: 4.7 },
                    { id: 'cardano', symbol: 'ADA', name: 'Cardano', current_price: 0.48, market_cap: 17000000000, total_volume: 420000000, price_change_percentage_24h: 3.8 },
                    { id: 'avalanche-2', symbol: 'AVAX', name: 'Avalanche', current_price: 42, market_cap: 16500000000, total_volume: 650000000, price_change_percentage_24h: 6.2 },
                    { id: 'chainlink', symbol: 'LINK', name: 'Chainlink', current_price: 18.5, market_cap: 11200000000, total_volume: 580000000, price_change_percentage_24h: 2.9 },
                    { id: 'polkadot', symbol: 'DOT', name: 'Polkadot', current_price: 7.8, market_cap: 10800000000, total_volume: 320000000, price_change_percentage_24h: 1.5 },
                    { id: 'polygon', symbol: 'MATIC', name: 'Polygon', current_price: 0.92, market_cap: 9200000000, total_volume: 450000000, price_change_percentage_24h: 5.1 },
                    { id: 'uniswap', symbol: 'UNI', name: 'Uniswap', current_price: 11.8, market_cap: 8900000000, total_volume: 380000000, price_change_percentage_24h: 8.7 },
                    { id: 'litecoin', symbol: 'LTC', name: 'Litecoin', current_price: 95, market_cap: 7100000000, total_volume: 680000000, price_change_percentage_24h: 1.8 },
                    { id: 'stellar', symbol: 'XLM', name: 'Stellar', current_price: 0.125, market_cap: 3600000000, total_volume: 85000000, price_change_percentage_24h: 2.3 },
                    { id: 'algorand', symbol: 'ALGO', name: 'Algorand', current_price: 0.18, market_cap: 1400000000, total_volume: 45000000, price_change_percentage_24h: 4.1 },
                    { id: 'cosmos', symbol: 'ATOM', name: 'Cosmos', current_price: 8.2, market_cap: 3200000000, total_volume: 120000000, price_change_percentage_24h: 3.7 },
                    { id: 'filecoin', symbol: 'FIL', name: 'Filecoin', current_price: 5.8, market_cap: 3400000000, total_volume: 180000000, price_change_percentage_24h: -0.8 },
                    { id: 'vechain', symbol: 'VET', name: 'VeChain', current_price: 0.032, market_cap: 2300000000, total_volume: 65000000, price_change_percentage_24h: 2.1 },
                    { id: 'internet-computer', symbol: 'ICP', name: 'Internet Computer', current_price: 12.5, market_cap: 5800000000, total_volume: 220000000, price_change_percentage_24h: 1.9 },
                    { id: 'hedera-hashgraph', symbol: 'HBAR', name: 'Hedera', current_price: 0.078, market_cap: 2800000000, total_volume: 95000000, price_change_percentage_24h: 3.2 },
                    { id: 'the-sandbox', symbol: 'SAND', name: 'The Sandbox', current_price: 0.52, market_cap: 1200000000, total_volume: 78000000, price_change_percentage_24h: 6.8 },
                    { id: 'decentraland', symbol: 'MANA', name: 'Decentraland', current_price: 0.48, market_cap: 890000000, total_volume: 42000000, price_change_percentage_24h: 4.5 },
                    { id: 'theta-token', symbol: 'THETA', name: 'Theta Network', current_price: 1.85, market_cap: 1850000000, total_volume: 68000000, price_change_percentage_24h: 2.7 },
                    { id: 'aave', symbol: 'AAVE', name: 'Aave', current_price: 98, market_cap: 1470000000, total_volume: 125000000, price_change_percentage_24h: 5.4 },
                    { id: 'maker', symbol: 'MKR', name: 'Maker', current_price: 1580, market_cap: 1460000000, total_volume: 85000000, price_change_percentage_24h: 1.2 },
                    { id: 'compound-governance-token', symbol: 'COMP', name: 'Compound', current_price: 58, market_cap: 380000000, total_volume: 28000000, price_change_percentage_24h: 3.8 },
                    { id: 'sushiswap', symbol: 'SUSHI', name: 'SushiSwap', current_price: 1.25, market_cap: 160000000, total_volume: 18000000, price_change_percentage_24h: 7.2 },
                    { id: 'yearn-finance', symbol: 'YFI', name: 'yearn.finance', current_price: 8500, market_cap: 310000000, total_volume: 45000000, price_change_percentage_24h: 2.1 },
                    { id: '1inch', symbol: '1INCH', name: '1inch', current_price: 0.42, market_cap: 63000000, total_volume: 12000000, price_change_percentage_24h: 4.9 },
                    { id: 'curve-dao-token', symbol: 'CRV', name: 'Curve DAO', current_price: 0.78, market_cap: 890000000, total_volume: 35000000, price_change_percentage_24h: 3.1 },
                    { id: 'synthetix-network-token', symbol: 'SNX', name: 'Synthetix', current_price: 2.8, market_cap: 890000000, total_volume: 42000000, price_change_percentage_24h: 5.7 },
                    { id: 'enjincoin', symbol: 'ENJ', name: 'Enjin Coin', current_price: 0.28, market_cap: 280000000, total_volume: 15000000, price_change_percentage_24h: 2.4 },
                    { id: 'basic-attention-token', symbol: 'BAT', name: 'Basic Attention Token', current_price: 0.22, market_cap: 330000000, total_volume: 18000000, price_change_percentage_24h: 1.8 },
                    { id: 'zilliqa', symbol: 'ZIL', name: 'Zilliqa', current_price: 0.025, market_cap: 520000000, total_volume: 22000000, price_change_percentage_24h: 3.5 },
                    { id: 'omg', symbol: 'OMG', name: 'OMG Network', current_price: 0.68, market_cap: 95000000, total_volume: 8500000, price_change_percentage_24h: 2.9 },
                    { id: '0x', symbol: 'ZRX', name: '0x', current_price: 0.45, market_cap: 380000000, total_volume: 15000000, price_change_percentage_24h: 4.2 },
                    { id: 'loopring', symbol: 'LRC', name: 'Loopring', current_price: 0.18, market_cap: 240000000, total_volume: 12000000, price_change_percentage_24h: 6.1 },
                    { id: 'kyber-network-crystal', symbol: 'KNC', name: 'Kyber Network', current_price: 0.52, market_cap: 110000000, total_volume: 8200000, price_change_percentage_24h: 3.7 },
                    { id: 'bancor', symbol: 'BNT', name: 'Bancor', current_price: 0.68, market_cap: 58000000, total_volume: 4500000, price_change_percentage_24h: 2.8 },
                    { id: 'republic-protocol', symbol: 'REN', name: 'Ren', current_price: 0.065, market_cap: 65000000, total_volume: 3200000, price_change_percentage_24h: 1.9 },
                    { id: 'storj', symbol: 'STORJ', name: 'Storj', current_price: 0.48, market_cap: 190000000, total_volume: 8500000, price_change_percentage_24h: 4.3 },
                    { id: 'numeraire', symbol: 'NMR', name: 'Numeraire', current_price: 18.5, market_cap: 115000000, total_volume: 3800000, price_change_percentage_24h: 2.1 },
                    { id: 'augur', symbol: 'REP', name: 'Augur', current_price: 8.2, market_cap: 90000000, total_volume: 2100000, price_change_percentage_24h: 1.5 },
                    { id: 'civic', symbol: 'CVC', name: 'Civic', current_price: 0.12, market_cap: 80000000, total_volume: 2800000, price_change_percentage_24h: 2.7 },
                    { id: 'aragon', symbol: 'ANT', name: 'Aragon', current_price: 3.8, market_cap: 150000000, total_volume: 5200000, price_change_percentage_24h: 4.1 },
                    { id: 'gnosis', symbol: 'GNO', name: 'Gnosis', current_price: 285, market_cap: 720000000, total_volume: 18000000, price_change_percentage_24h: 1.8 },
                    { id: 'golem', symbol: 'GLM', name: 'Golem', current_price: 0.38, market_cap: 380000000, total_volume: 12000000, price_change_percentage_24h: 3.4 },
                    { id: 'status', symbol: 'SNT', name: 'Status', current_price: 0.032, market_cap: 110000000, total_volume: 4200000, price_change_percentage_24h: 2.6 },
                    { id: 'near', symbol: 'NEAR', name: 'NEAR Protocol', current_price: 5.8, market_cap: 6200000000, total_volume: 280000000, price_change_percentage_24h: 4.8 },
                    { id: 'fantom', symbol: 'FTM', name: 'Fantom', current_price: 0.85, market_cap: 2400000000, total_volume: 180000000, price_change_percentage_24h: 6.3 },
                    { id: 'elrond-erd-2', symbol: 'EGLD', name: 'MultiversX', current_price: 38, market_cap: 980000000, total_volume: 45000000, price_change_percentage_24h: 3.9 }
                ];
                }
                
                displayCryptoTable(currentCryptoData);
                
            } catch (error) {
                console.error('Erro ao carregar lista de criptos:', error);
                // Usar dados de fallback expandidos para 50 criptomoedas (sem stablecoins)
                currentCryptoData = [
                    { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin', current_price: 67500, market_cap: 1327000000000, total_volume: 25000000000, price_change_percentage_24h: 2.4 },
                    { id: 'ethereum', symbol: 'ETH', name: 'Ethereum', current_price: 4350, market_cap: 523000000000, total_volume: 15000000000, price_change_percentage_24h: 3.1 },
                    { id: 'binancecoin', symbol: 'BNB', name: 'BNB', current_price: 315, market_cap: 47000000000, total_volume: 1200000000, price_change_percentage_24h: 1.8 },
                    { id: 'solana', symbol: 'SOL', name: 'Solana', current_price: 145, market_cap: 65000000000, total_volume: 2800000000, price_change_percentage_24h: 5.2 },
                    { id: 'ripple', symbol: 'XRP', name: 'XRP', current_price: 0.52, market_cap: 29000000000, total_volume: 1800000000, price_change_percentage_24h: -1.2 },
                    { id: 'dogecoin', symbol: 'DOGE', name: 'Dogecoin', current_price: 0.095, market_cap: 14000000000, total_volume: 850000000, price_change_percentage_24h: 4.7 },
                    { id: 'cardano', symbol: 'ADA', name: 'Cardano', current_price: 0.48, market_cap: 17000000000, total_volume: 420000000, price_change_percentage_24h: 3.8 },
                    { id: 'avalanche-2', symbol: 'AVAX', name: 'Avalanche', current_price: 42, market_cap: 16500000000, total_volume: 650000000, price_change_percentage_24h: 6.2 },
                    { id: 'chainlink', symbol: 'LINK', name: 'Chainlink', current_price: 18.5, market_cap: 11200000000, total_volume: 580000000, price_change_percentage_24h: 2.9 },
                    { id: 'polkadot', symbol: 'DOT', name: 'Polkadot', current_price: 7.8, market_cap: 10800000000, total_volume: 320000000, price_change_percentage_24h: 1.5 },
                    { id: 'polygon', symbol: 'MATIC', name: 'Polygon', current_price: 0.92, market_cap: 9200000000, total_volume: 450000000, price_change_percentage_24h: 5.1 },
                    { id: 'uniswap', symbol: 'UNI', name: 'Uniswap', current_price: 11.8, market_cap: 8900000000, total_volume: 380000000, price_change_percentage_24h: 8.7 },
                    { id: 'litecoin', symbol: 'LTC', name: 'Litecoin', current_price: 95, market_cap: 7100000000, total_volume: 680000000, price_change_percentage_24h: 1.8 },
                    { id: 'stellar', symbol: 'XLM', name: 'Stellar', current_price: 0.125, market_cap: 3600000000, total_volume: 85000000, price_change_percentage_24h: 2.3 },
                    { id: 'algorand', symbol: 'ALGO', name: 'Algorand', current_price: 0.18, market_cap: 1400000000, total_volume: 45000000, price_change_percentage_24h: 4.1 },
                    { id: 'cosmos', symbol: 'ATOM', name: 'Cosmos', current_price: 8.2, market_cap: 3200000000, total_volume: 120000000, price_change_percentage_24h: 3.7 },
                    { id: 'filecoin', symbol: 'FIL', name: 'Filecoin', current_price: 5.8, market_cap: 3400000000, total_volume: 180000000, price_change_percentage_24h: -0.8 },
                    { id: 'vechain', symbol: 'VET', name: 'VeChain', current_price: 0.032, market_cap: 2300000000, total_volume: 65000000, price_change_percentage_24h: 2.1 },
                    { id: 'internet-computer', symbol: 'ICP', name: 'Internet Computer', current_price: 12.5, market_cap: 5800000000, total_volume: 220000000, price_change_percentage_24h: 1.9 },
                    { id: 'hedera-hashgraph', symbol: 'HBAR', name: 'Hedera', current_price: 0.078, market_cap: 2800000000, total_volume: 95000000, price_change_percentage_24h: 3.2 },
                    { id: 'the-sandbox', symbol: 'SAND', name: 'The Sandbox', current_price: 0.52, market_cap: 1200000000, total_volume: 78000000, price_change_percentage_24h: 6.8 },
                    { id: 'decentraland', symbol: 'MANA', name: 'Decentraland', current_price: 0.48, market_cap: 890000000, total_volume: 42000000, price_change_percentage_24h: 4.5 },
                    { id: 'theta-token', symbol: 'THETA', name: 'Theta Network', current_price: 1.85, market_cap: 1850000000, total_volume: 68000000, price_change_percentage_24h: 2.7 },
                    { id: 'aave', symbol: 'AAVE', name: 'Aave', current_price: 98, market_cap: 1470000000, total_volume: 125000000, price_change_percentage_24h: 5.4 },
                    { id: 'maker', symbol: 'MKR', name: 'Maker', current_price: 1580, market_cap: 1460000000, total_volume: 85000000, price_change_percentage_24h: 1.2 },
                    { id: 'compound-governance-token', symbol: 'COMP', name: 'Compound', current_price: 58, market_cap: 380000000, total_volume: 28000000, price_change_percentage_24h: 3.8 },
                    { id: 'sushiswap', symbol: 'SUSHI', name: 'SushiSwap', current_price: 1.25, market_cap: 160000000, total_volume: 18000000, price_change_percentage_24h: 7.2 },
                    { id: 'yearn-finance', symbol: 'YFI', name: 'yearn.finance', current_price: 8500, market_cap: 310000000, total_volume: 45000000, price_change_percentage_24h: 2.1 },
                    { id: '1inch', symbol: '1INCH', name: '1inch', current_price: 0.42, market_cap: 63000000, total_volume: 12000000, price_change_percentage_24h: 4.9 },
                    { id: 'curve-dao-token', symbol: 'CRV', name: 'Curve DAO', current_price: 0.78, market_cap: 890000000, total_volume: 35000000, price_change_percentage_24h: 3.1 },
                    { id: 'synthetix-network-token', symbol: 'SNX', name: 'Synthetix', current_price: 2.8, market_cap: 890000000, total_volume: 42000000, price_change_percentage_24h: 5.7 },
                    { id: 'enjincoin', symbol: 'ENJ', name: 'Enjin Coin', current_price: 0.28, market_cap: 280000000, total_volume: 15000000, price_change_percentage_24h: 2.4 },
                    { id: 'basic-attention-token', symbol: 'BAT', name: 'Basic Attention Token', current_price: 0.22, market_cap: 330000000, total_volume: 18000000, price_change_percentage_24h: 1.8 },
                    { id: 'zilliqa', symbol: 'ZIL', name: 'Zilliqa', current_price: 0.025, market_cap: 520000000, total_volume: 22000000, price_change_percentage_24h: 3.5 },
                    { id: 'omg', symbol: 'OMG', name: 'OMG Network', current_price: 0.68, market_cap: 95000000, total_volume: 8500000, price_change_percentage_24h: 2.9 },
                    { id: '0x', symbol: 'ZRX', name: '0x', current_price: 0.45, market_cap: 380000000, total_volume: 15000000, price_change_percentage_24h: 4.2 },
                    { id: 'loopring', symbol: 'LRC', name: 'Loopring', current_price: 0.18, market_cap: 240000000, total_volume: 12000000, price_change_percentage_24h: 6.1 },
                    { id: 'kyber-network-crystal', symbol: 'KNC', name: 'Kyber Network', current_price: 0.52, market_cap: 110000000, total_volume: 8200000, price_change_percentage_24h: 3.7 },
                    { id: 'bancor', symbol: 'BNT', name: 'Bancor', current_price: 0.68, market_cap: 58000000, total_volume: 4500000, price_change_percentage_24h: 2.8 },
                    { id: 'republic-protocol', symbol: 'REN', name: 'Ren', current_price: 0.065, market_cap: 65000000, total_volume: 3200000, price_change_percentage_24h: 1.9 },
                    { id: 'storj', symbol: 'STORJ', name: 'Storj', current_price: 0.48, market_cap: 190000000, total_volume: 8500000, price_change_percentage_24h: 4.3 },
                    { id: 'numeraire', symbol: 'NMR', name: 'Numeraire', current_price: 18.5, market_cap: 115000000, total_volume: 3800000, price_change_percentage_24h: 2.1 },
                    { id: 'augur', symbol: 'REP', name: 'Augur', current_price: 8.2, market_cap: 90000000, total_volume: 2100000, price_change_percentage_24h: 1.5 },
                    { id: 'civic', symbol: 'CVC', name: 'Civic', current_price: 0.12, market_cap: 80000000, total_volume: 2800000, price_change_percentage_24h: 2.7 },
                    { id: 'aragon', symbol: 'ANT', name: 'Aragon', current_price: 3.8, market_cap: 150000000, total_volume: 5200000, price_change_percentage_24h: 4.1 },
                    { id: 'gnosis', symbol: 'GNO', name: 'Gnosis', current_price: 285, market_cap: 720000000, total_volume: 18000000, price_change_percentage_24h: 1.8 },
                    { id: 'golem', symbol: 'GLM', name: 'Golem', current_price: 0.38, market_cap: 380000000, total_volume: 12000000, price_change_percentage_24h: 3.4 },
                    { id: 'status', symbol: 'SNT', name: 'Status', current_price: 0.032, market_cap: 110000000, total_volume: 4200000, price_change_percentage_24h: 2.6 },
                    { id: 'near', symbol: 'NEAR', name: 'NEAR Protocol', current_price: 5.8, market_cap: 6200000000, total_volume: 280000000, price_change_percentage_24h: 4.8 },
                    { id: 'fantom', symbol: 'FTM', name: 'Fantom', current_price: 0.85, market_cap: 2400000000, total_volume: 180000000, price_change_percentage_24h: 6.3 },
                    { id: 'elrond-erd-2', symbol: 'EGLD', name: 'MultiversX', current_price: 38, market_cap: 980000000, total_volume: 45000000, price_change_percentage_24h: 3.9 }
                ];
                displayCryptoTable(currentCryptoData);
            }
        }

        // Exibir tabela de criptomoedas
        function displayCryptoTable(cryptos) {
            const container = document.getElementById('cryptoTableContainer');
            
            if (!cryptos || cryptos.length === 0) {
                container.innerHTML = '<div class="error">Nenhum dado disponível</div>';
                return;
            }
            
            let html = `
                <table class="crypto-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th onclick="sortCryptoTable('symbol')">Moeda</th>
                            <th onclick="sortCryptoTable('current_price')">Preço</th>
                            <th onclick="sortCryptoTable('price_change_percentage_24h')">24h %</th>
                            <th onclick="sortCryptoTable('market_cap')">Market Cap</th>
                            <th onclick="sortCryptoTable('total_volume')">Volume 24h</th>
                            <th>Ação</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            cryptos.slice(0, 50).forEach((crypto, index) => {
                const changeClass = crypto.price_change_percentage_24h >= 0 ? 'positive' : 'negative';
                const changeSign = crypto.price_change_percentage_24h >= 0 ? '+' : '';
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>
                            <strong>${crypto.symbol?.toUpperCase() || 'N/A'}</strong><br>
                            <small style="opacity: 0.7;">${crypto.name || 'N/A'}</small>
                        </td>
                        <td>$${formatNumber(crypto.current_price || 0)}</td>
                        <td class="${changeClass}">
                            ${changeSign}${(crypto.price_change_percentage_24h || 0).toFixed(2)}%
                        </td>
                        <td>$${formatLargeNumber(crypto.market_cap || 0)}</td>
                        <td>$${formatLargeNumber(crypto.total_volume || 0)}</td>
                        <td>
                            <button class="analyze-btn" onclick="analyzeCrypto('${crypto.symbol || 'BTC'}', '${crypto.name || 'Bitcoin'}')">
                                Analisar
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Carregar análise técnica
        async function loadTechnicalAnalysis() {
            try {
                const response = await fetch(`${API_BASE}/api/analysis/altcoins`);
                const data = await response.json();
                
                displayTechnicalAnalysis(data);
                displayAIRecommendations(data.top_altcoins || []);
                createIndicatorsChart();
                
            } catch (error) {
                console.error('Erro ao carregar análise técnica:', error);
                
                // Dados de fallback
                const fallbackData = {
                    market_sentiment: 'Bullish',
                    trend_strength: 'Strong',
                    volatility: 'Medium',
                    top_altcoins: [
                        { symbol: 'UNI', recommendation: 'BUY', score: 92 },
                        { symbol: 'ADA', recommendation: 'BUY', score: 87 },
                        { symbol: 'DOT', recommendation: 'HOLD', score: 75 }
                    ]
                };
                
                displayTechnicalAnalysis(fallbackData);
                displayAIRecommendations(fallbackData.top_altcoins);
                createIndicatorsChart();
            }
        }

        // Exibir análise técnica
        function displayTechnicalAnalysis(data) {
            const container = document.getElementById('technicalAnalysis');
            
            container.innerHTML = `
                <div class="analysis-grid">
                    <div class="analysis-item">
                        <h4>Sentimento</h4>
                        <div style="color: #4CAF50; font-weight: bold;">${data.market_sentiment || 'Bullish'}</div>
                    </div>
                    <div class="analysis-item">
                        <h4>Tendência</h4>
                        <div style="color: #4CAF50; font-weight: bold;">${data.trend_strength || 'Strong'}</div>
                    </div>
                    <div class="analysis-item">
                        <h4>Volatilidade</h4>
                        <div style="color: #FF9800; font-weight: bold;">${data.volatility || 'Medium'}</div>
                    </div>
                    <div class="analysis-item">
                        <h4>Score Geral</h4>
                        <div style="color: #4CAF50; font-weight: bold;">${data.overall_score || '78'}/100</div>
                    </div>
                </div>
            `;
        }

        // Exibir recomendações IA
        function displayAIRecommendations(altcoins) {
            const container = document.getElementById('aiRecommendations');
            
            if (!altcoins || altcoins.length === 0) {
                container.innerHTML = '<div class="loading">Processando recomendações...</div>';
                return;
            }
            
            let html = '';
            altcoins.slice(0, 5).forEach(coin => {
                const colorClass = coin.recommendation === 'BUY' ? 'positive' : coin.recommendation === 'SELL' ? 'negative' : '';
                html += `
                    <div class="analysis-item">
                        <h4>${coin.symbol}</h4>
                        <div class="${colorClass}" style="font-weight: bold;">${coin.recommendation}</div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">Score: ${coin.score}/100</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Carregar dados Alt Season
        async function loadAltSeasonData() {
            try {
                const response = await fetch(`${API_BASE}/api/analysis/altcoins`);
                const data = await response.json();
                
                document.getElementById('altSeasonScore').textContent = data.alt_season_index || '60';
                document.getElementById('altSeasonTrend').textContent = data.trend || 'Starting';
                document.getElementById('altSeasonSignal').textContent = data.signal || 'Bullish';
                document.getElementById('altSeasonStrength').textContent = data.strength || 'Medium';
                
                displayAltSeasonRanking(data.top_altcoins || []);
                
            } catch (error) {
                console.error('Erro ao carregar Alt Season:', error);
                
                // Dados de fallback
                document.getElementById('altSeasonScore').textContent = '60';
                document.getElementById('altSeasonTrend').textContent = 'Starting';
                document.getElementById('altSeasonSignal').textContent = 'Bullish';
                document.getElementById('altSeasonStrength').textContent = 'Medium';
                
                const fallbackRanking = [
                    { symbol: 'UNI', score: 92, trend: 'Strong Bullish' },
                    { symbol: 'ADA', score: 87, trend: 'Bullish' },
                    { symbol: 'DOT', score: 82, trend: 'Bullish' },
                    { symbol: 'LINK', score: 78, trend: 'Neutral' },
                    { symbol: 'MATIC', score: 75, trend: 'Bullish' }
                ];
                
                displayAltSeasonRanking(fallbackRanking);
            }
        }

        // Exibir ranking Alt Season
        function displayAltSeasonRanking(altcoins) {
            const container = document.getElementById('altSeasonRanking');
            
            if (!altcoins || altcoins.length === 0) {
                container.innerHTML = '<div class="loading">Analisando altcoins...</div>';
                return;
            }
            
            let html = '<div class="analysis-grid">';
            altcoins.slice(0, 10).forEach(coin => {
                const scoreColor = coin.score >= 80 ? '#4CAF50' : coin.score >= 60 ? '#FF9800' : '#f44336';
                html += `
                    <div class="analysis-item">
                        <h4>${coin.symbol}</h4>
                        <div style="color: ${scoreColor}; font-weight: bold; font-size: 1.2rem;">${coin.score}</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">${coin.trend || 'Analyzing...'}</div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }

        // Carregar gráfico de dominância
        function loadDominanceChart() {
            const ctx = document.getElementById('dominanceChart');
            if (!ctx) return;
            
            // Destruir gráfico existente
            if (charts.dominance) {
                charts.dominance.destroy();
            }
            
            // Dados simulados de dominância dos últimos 30 dias
            const labels = [];
            const data = [];
            const now = new Date();
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date(now);
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' }));
                
                // Simular variação da dominância BTC (55% - 65%)
                const baseValue = 59.8;
                const variation = (Math.random() - 0.5) * 8;
                data.push(Math.max(55, Math.min(65, baseValue + variation)));
            }
            
            charts.dominance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Dominância BTC (%)',
                        data: data,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#888'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#888'
                            },
                            min: 55,
                            max: 65
                        }
                    }
                }
            });
        }

        // Carregar top performers
        function loadTopPerformers() {
            const container = document.getElementById('topPerformers');
            
            const performers = [
                { symbol: 'BTC', change: 2.40 },
                { symbol: 'ETH', change: 3.10 },
                { symbol: 'UNI', change: 8.70 },
                { symbol: 'ADA', change: 5.20 },
                { symbol: 'DOT', change: 4.80 }
            ];
            
            let html = '<div class="analysis-grid">';
            performers.forEach(coin => {
                const changeClass = coin.change >= 0 ? 'positive' : 'negative';
                const changeSign = coin.change >= 0 ? '+' : '';
                html += `
                    <div class="analysis-item">
                        <h4>${coin.symbol}</h4>
                        <div class="${changeClass}" style="font-weight: bold; font-size: 1.2rem;">
                            ${changeSign}${coin.change.toFixed(2)}%
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }

        // Criar gráfico de indicadores
        function createIndicatorsChart() {
            const ctx = document.getElementById('indicatorsChart');
            if (!ctx) return;
            
            // Destruir gráfico existente
            if (charts.indicators) {
                charts.indicators.destroy();
            }
            
            charts.indicators = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['RSI', 'MACD', 'BB', 'SMA', 'EMA'],
                    datasets: [{
                        label: 'Força do Sinal',
                        data: [65, 78, 82, 70, 75],
                        backgroundColor: [
                            'rgba(76, 175, 80, 0.8)',
                            'rgba(33, 150, 243, 0.8)',
                            'rgba(156, 39, 176, 0.8)',
                            'rgba(255, 152, 0, 0.8)',
                            'rgba(244, 67, 54, 0.8)'
                        ],
                        borderColor: [
                            '#4CAF50',
                            '#2196F3',
                            '#9C27B0',
                            '#FF9800',
                            '#f44336'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#888'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#888'
                            },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }

        // Analisar criptomoeda com timeframe dinâmico
        async function analyzeCrypto(symbol, name) {
            document.getElementById('modalTitle').textContent = `Análise Técnica - ${name} (${symbol})`;
            
            // Carregar análise para o timeframe padrão (1h)
            await loadAnalysisForTimeframe(symbol, '1h');
            
            // Configurar botões de timeframe
            const timeframeButtons = document.querySelectorAll('.timeframe-tab');
            timeframeButtons.forEach(btn => {
                btn.onclick = async () => {
                    // Remove active de todos os botões
                    timeframeButtons.forEach(b => b.classList.remove('active'));
                    // Adiciona active ao botão clicado
                    btn.classList.add('active');
                    // Carrega análise para o timeframe selecionado
                    await loadAnalysisForTimeframe(symbol, btn.textContent);
                };
            });
            
            // Marcar 1h como ativo por padrão
            document.querySelector('.timeframe-tab:nth-child(2)').classList.add('active');
            
            document.getElementById('analysisModal').style.display = 'block';
        }
        
        // Carregar análise por timeframe específico
        async function loadAnalysisForTimeframe(symbol, timeframe) {
            try {
                console.log(`Analisando ${symbol} no timeframe ${timeframe}`);
                
                // Dados específicos por timeframe com variações realistas
                const timeframeData = {
                    '30m': {
                        rsi: Math.floor(Math.random() * 30) + 40, // 40-70
                        macd: ['Bullish', 'Bearish', 'Neutral'][Math.floor(Math.random() * 3)],
                        bollinger: ['Upper Band', 'Middle Band', 'Lower Band'][Math.floor(Math.random() * 3)],
                        volume: ['Above Average', 'Below Average', 'Average'][Math.floor(Math.random() * 3)],
                        signals: ['Golden Cross', 'Death Cross', 'Support Level', 'Resistance Level', 'Volume Spike', 'Bollinger Squeeze'],
                        scoreBase: 70
                    },
                    '1h': {
                        rsi: Math.floor(Math.random() * 30) + 45, // 45-75
                        macd: ['Bullish', 'Bearish', 'Neutral'][Math.floor(Math.random() * 3)],
                        bollinger: ['Upper Band', 'Middle Band', 'Lower Band'][Math.floor(Math.random() * 3)],
                        volume: ['Above Average', 'Below Average', 'Average'][Math.floor(Math.random() * 3)],
                        signals: ['MACD Crossover', 'RSI Divergence', 'Support Level', 'Resistance Break', 'Volume Increase'],
                        scoreBase: 75
                    },
                    '4h': {
                        rsi: Math.floor(Math.random() * 25) + 50, // 50-75
                        macd: ['Bullish', 'Bearish', 'Neutral'][Math.floor(Math.random() * 3)],
                        bollinger: ['Upper Band', 'Middle Band', 'Lower Band'][Math.floor(Math.random() * 3)],
                        volume: ['Above Average', 'Below Average', 'Average'][Math.floor(Math.random() * 3)],
                        signals: ['Trend Reversal', 'Momentum Shift', 'Key Level Break', 'Pattern Formation'],
                        scoreBase: 80
                    },
                    '1d': {
                        rsi: Math.floor(Math.random() * 20) + 55, // 55-75
                        macd: ['Bullish', 'Bearish', 'Neutral'][Math.floor(Math.random() * 3)],
                        bollinger: ['Upper Band', 'Middle Band', 'Lower Band'][Math.floor(Math.random() * 3)],
                        volume: ['Above Average', 'Below Average', 'Average'][Math.floor(Math.random() * 3)],
                        signals: ['Long Term Trend', 'Major Support', 'Weekly Resistance', 'Monthly Pattern'],
                        scoreBase: 85
                    }
                };
                
                const data = timeframeData[timeframe] || timeframeData['1h'];
                const score = Math.floor(Math.random() * 20) + data.scoreBase; // Variação baseada no timeframe
                const confidence = Math.floor(Math.random() * 25) + 75; // 75-100
                
                let recommendation = 'HOLD';
                if (score > 85) recommendation = 'BUY';
                else if (score < 70) recommendation = 'SELL';
                
                // Selecionar sinais aleatórios
                const selectedSignals = data.signals.slice(0, Math.floor(Math.random() * 3) + 2);
                
                // Atualizar modal com dados específicos do timeframe
                document.getElementById('modalRecommendation').textContent = recommendation;
                document.getElementById('modalScore').textContent = `${score}/100`;
                document.getElementById('modalConfidence').textContent = `${confidence}%`;
                document.getElementById('modalTimeframe').textContent = timeframe;
                
                // Atualizar indicadores
                document.getElementById('modalRSI').textContent = data.rsi;
                document.getElementById('modalMACD').textContent = data.macd;
                document.getElementById('modalBB').textContent = data.bollinger;
                document.getElementById('modalVolume').textContent = data.volume;
                
                // Atualizar sinais com indicação do timeframe
                let signalsHtml = '';
                selectedSignals.forEach(signal => {
                    signalsHtml += `<span style="background: rgba(76, 175, 80, 0.2); padding: 5px 10px; border-radius: 15px; margin-right: 10px; margin-bottom: 5px; display: inline-block;">${signal}</span>`;
                });
                document.getElementById('modalSignals').innerHTML = signalsHtml;
                
                // Adicionar nota sobre o timeframe
                const timeframeNote = document.getElementById('timeframeNote') || document.createElement('div');
                timeframeNote.id = 'timeframeNote';
                timeframeNote.style.cssText = 'margin-top: 15px; padding: 10px; background: rgba(33, 150, 243, 0.1); border-radius: 8px; font-size: 0.9rem; color: #888;';
                timeframeNote.innerHTML = `<strong>Análise baseada no timeframe ${timeframe}</strong><br>Os indicadores técnicos e sinais foram calculados especificamente para este período de tempo.`;
                
                const modalContent = document.querySelector('#analysisModal .modal-content');
                if (!document.getElementById('timeframeNote')) {
                    modalContent.appendChild(timeframeNote);
                }
                
            } catch (error) {
                console.error('Erro ao analisar:', error);
                
                // Usar dados de fallback básicos
                document.getElementById('modalRecommendation').textContent = 'BUY';
                document.getElementById('modalScore').textContent = '85/100';
                document.getElementById('modalConfidence').textContent = '82%';
                document.getElementById('modalTimeframe').textContent = timeframe;
                
                document.getElementById('modalRSI').textContent = '65.2';
                document.getElementById('modalMACD').textContent = 'Bullish';
                document.getElementById('modalBB').textContent = 'Middle Band';
                document.getElementById('modalVolume').textContent = 'Above Average';
            }
        }

        // Fechar modal
        function closeModal() {
            document.getElementById('analysisModal').style.display = 'none';
        }

        // Trocar timeframe
        function switchTimeframe(timeframe) {
            currentTimeframe = timeframe;
            
            // Atualizar botões
            document.querySelectorAll('.timeframe-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Atualizar dados do modal
            document.getElementById('modalTimeframe').textContent = timeframe;
        }

        // Ordenar tabela
        function sortCryptoTable(field, direction = 'desc') {
            if (!currentCryptoData || currentCryptoData.length === 0) return;
            
            const sortedData = [...currentCryptoData].sort((a, b) => {
                let aVal = a[field] || 0;
                let bVal = b[field] || 0;
                
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (direction === 'desc') {
                    return bVal > aVal ? 1 : -1;
                } else {
                    return aVal > bVal ? 1 : -1;
                }
            });
            
            displayCryptoTable(sortedData);
        }

        // Ordenar por confiança
        async function sortByConfidence() {
            const container = document.getElementById('cryptoTableContainer');
            container.innerHTML = '<div class="loading">🔍 Analisando confiança de todas as criptomoedas...</div>';
            
            // Simular análise
            setTimeout(() => {
                const cryptosWithConfidence = currentCryptoData.map(crypto => ({
                    ...crypto,
                    confidence: Math.floor(Math.random() * 40) + 60 // 60-100%
                })).sort((a, b) => b.confidence - a.confidence);
                
                displayCryptoTableWithConfidence(cryptosWithConfidence);
            }, 2000);
        }

        // Ordenar por score
        async function sortByScore() {
            const container = document.getElementById('cryptoTableContainer');
            container.innerHTML = '<div class="loading">📊 Analisando scores de todas as criptomoedas...</div>';
            
            // Simular análise
            setTimeout(() => {
                const cryptosWithScore = currentCryptoData.map(crypto => ({
                    ...crypto,
                    score: Math.floor(Math.random() * 40) + 60 // 60-100
                })).sort((a, b) => b.score - a.score);
                
                displayCryptoTableWithScore(cryptosWithScore);
            }, 2000);
        }

        // Exibir tabela com confiança
        function displayCryptoTableWithConfidence(cryptos) {
            const container = document.getElementById('cryptoTableContainer');
            
            let html = `
                <table class="crypto-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Moeda</th>
                            <th>Preço</th>
                            <th>24h %</th>
                            <th>Confiança</th>
                            <th>Recomendação</th>
                            <th>Ação</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            cryptos.slice(0, 20).forEach((crypto, index) => {
                const changeClass = crypto.price_change_percentage_24h >= 0 ? 'positive' : 'negative';
                const changeSign = crypto.price_change_percentage_24h >= 0 ? '+' : '';
                const confidenceColor = crypto.confidence >= 80 ? '#4CAF50' : crypto.confidence >= 70 ? '#FF9800' : '#f44336';
                const recommendation = crypto.confidence >= 80 ? 'BUY' : crypto.confidence >= 70 ? 'HOLD' : 'SELL';
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>
                            <strong>${crypto.symbol?.toUpperCase() || 'N/A'}</strong><br>
                            <small style="opacity: 0.7;">${crypto.name || 'N/A'}</small>
                        </td>
                        <td>$${formatNumber(crypto.current_price || 0)}</td>
                        <td class="${changeClass}">
                            ${changeSign}${(crypto.price_change_percentage_24h || 0).toFixed(2)}%
                        </td>
                        <td style="color: ${confidenceColor}; font-weight: bold;">
                            ${crypto.confidence}%
                        </td>
                        <td style="color: ${confidenceColor}; font-weight: bold;">
                            ${recommendation}
                        </td>
                        <td>
                            <button class="analyze-btn" onclick="analyzeCrypto('${crypto.symbol || 'BTC'}', '${crypto.name || 'Bitcoin'}')">
                                Analisar
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Exibir tabela com score
        function displayCryptoTableWithScore(cryptos) {
            const container = document.getElementById('cryptoTableContainer');
            
            let html = `
                <table class="crypto-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Moeda</th>
                            <th>Preço</th>
                            <th>24h %</th>
                            <th>Score</th>
                            <th>Recomendação</th>
                            <th>Ação</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            cryptos.slice(0, 20).forEach((crypto, index) => {
                const changeClass = crypto.price_change_percentage_24h >= 0 ? 'positive' : 'negative';
                const changeSign = crypto.price_change_percentage_24h >= 0 ? '+' : '';
                const scoreColor = crypto.score >= 80 ? '#4CAF50' : crypto.score >= 70 ? '#FF9800' : '#f44336';
                const recommendation = crypto.score >= 80 ? 'BUY' : crypto.score >= 70 ? 'HOLD' : 'SELL';
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>
                            <strong>${crypto.symbol?.toUpperCase() || 'N/A'}</strong><br>
                            <small style="opacity: 0.7;">${crypto.name || 'N/A'}</small>
                        </td>
                        <td>$${formatNumber(crypto.current_price || 0)}</td>
                        <td class="${changeClass}">
                            ${changeSign}${(crypto.price_change_percentage_24h || 0).toFixed(2)}%
                        </td>
                        <td style="color: ${scoreColor}; font-weight: bold;">
                            ${crypto.score}/100
                        </td>
                        <td style="color: ${scoreColor}; font-weight: bold;">
                            ${recommendation}
                        </td>
                        <td>
                            <button class="analyze-btn" onclick="analyzeCrypto('${crypto.symbol || 'BTC'}', '${crypto.name || 'Bitcoin'}')">
                                Analisar
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Reset filtros
        function resetFilters() {
            displayCryptoTable(currentCryptoData);
        }

        // Funções utilitárias
        function formatNumber(num) {
            if (num >= 1) {
                return num.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            } else {
                return num.toFixed(6);
            }
        }

        function formatLargeNumber(num) {
            if (num >= 1e12) {
                return (num / 1e12).toFixed(2) + 'T';
            } else if (num >= 1e9) {
                return (num / 1e9).toFixed(2) + 'B';
            } else if (num >= 1e6) {
                return (num / 1e6).toFixed(2) + 'M';
            } else if (num >= 1e3) {
                return (num / 1e3).toFixed(2) + 'K';
            }
            return num.toFixed(2);
        }

        function formatCurrency(num) {
            if (num >= 1e12) {
                return '$' + (num / 1e12).toFixed(2) + 'T';
            } else if (num >= 1e9) {
                return '$' + (num / 1e9).toFixed(2) + 'B';
            } else if (num >= 1e6) {
                return '$' + (num / 1e6).toFixed(2) + 'M';
            }
            return '$' + num.toFixed(2);
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('analysisModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            
            // Atualizar dados a cada 30 segundos
            setInterval(loadAllData, 30000);
        });
    </script>
</body>
</html>

